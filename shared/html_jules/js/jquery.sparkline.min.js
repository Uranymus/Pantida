<?php

function etJobbedSearch_search() {
	$helper = new ETJobbedSearch_Helper();
	$etJobbedProfileHelper = new ETJobbedProfile_Helper();

	$items = array(
			'featuredJobs' => $helper->themeFeaturedJobs(),
			'searchformMain' => $helper->themeSearchformMain(),
			'featuredCompanies' => $etJobbedProfileHelper->themeFeaturedCompanies(),
	);
	return theme('et_jobbed_search_overview', array('items' => $items));
}

function etJobbedSearch_searchJob() {
	$helper = new ETJobbedSearch_Helper();
	$jobbedLoginHelper = new ETJobbedLogin_Helper();
	$get = filter_input_array(INPUT_GET);
	$filters = array_keys($get);
	$filter_array = $helper->getActiveFilterArray($get);
	if (isset($get['favourite'])) {
		$favouriteSearch = $helper->favouriteSearch($get);
	}

	$items = array('refineSearchForm' => $helper->themeSearchformRefine(),
			'searchdetailsForm' => $helper->themeSearchResults(),
			'WelcomeBlock' => $jobbedLoginHelper->themeWelcomeBlock(),
			'MiddleBlock' => $helper->themeMiddleBlock(),
			'AdBlock' => ETJobbedAd_Helper::themeAd(),
	);

	/* foreach ($filters AS $filter) {
	  if ($filter_array[$filter] != "")
	  $items['activeFilters'].= "<div class='filterName'>$filter_array[$filter]</div>";
	  } */

	return theme('et_jobbed_search_list', array('items' => $items));
}

function etJobbedSearch_searchJobXY($id) {

	$helper = new ETJobbedSearch_Helper();
	$jobbedLoginHelper = new ETJobbedLogin_Helper();
	$database = new ETJobbedSearch_Database();
	$get = filter_input_array(INPUT_GET);


	$items = array('refineSearchForm' => $helper->themeSearchformRefine(),
			'WelcomeBlock' => $jobbedLoginHelper->themeWelcomeBlock(),
			'MiddleBlock' => $helper->themeMiddleBlock(),
			'AdBlock' => ETJobbedAd_Helper::themeAd(),
	);

	$items['results'] = $helper->getSearchDetail($id);
	$items['results']['location'] = $database->readLocations($items['results']['location_id'])[$items['results']['location_id']];
	$items['results']['area'] = $database->readAreas($items['results']['area_id'])[$items['results']['area_id']];
	$items['results']['industry'] = $database->readIndustry($items['results']['industry_id']);
	$items['results']['subindustry'] = $database->readSubindustries($items['results']['subindustry_id'])[$items['results']['subindustry_id']];
	$items['searchdetailsForm'] = $helper->themeSearchDetail($items);

	return theme('et_jobbed_search_detail', array('items' => $items));
}
